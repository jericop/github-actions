Creating multi-arch builder from TOML file 'example-builder.toml'...
e1f114c085ad8dc21b0bc74792a0fac81269781cf4868e7e568d745ce0de1b43
+ docker buildx build --platform linux/amd64,linux/arm64 --tag not-pushing-so-ignored --progress plain --file create-arch-builders.Dockerfile .
#0 building with "host-network" instance using docker-container driver

#1 [internal] load build definition from create-arch-builders.Dockerfile
#1 transferring dockerfile: 464B 0.0s done
#1 DONE 0.0s

#2 [linux/amd64 internal] load metadata for docker.io/buildpacksio/pack:latest
#2 ...

#3 [auth] buildpacksio/pack:pull token for registry-1.docker.io
#3 DONE 0.0s

#4 [linux/arm64 internal] load metadata for docker.io/buildpacksio/pack:latest
#4 DONE 3.4s

#5 [linux/arm64 internal] load metadata for ghcr.io/jericop/build-jammy:latest
#5 DONE 3.4s

#2 [linux/amd64 internal] load metadata for docker.io/buildpacksio/pack:latest
#2 DONE 3.4s

#6 [linux/amd64 internal] load metadata for ghcr.io/jericop/build-jammy:latest
#6 DONE 3.4s

#7 [internal] load .dockerignore
#7 transferring context: 2B done
#7 DONE 0.0s

#8 [internal] load build context
#8 DONE 0.0s

#9 [linux/arm64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 resolve ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 ...

#8 [internal] load build context
#8 transferring context: 468B done
#8 DONE 0.1s

#10 [linux/arm64 pack 1/1] FROM docker.io/buildpacksio/pack:latest@sha256:8b3d6cd25a8d49f02153b1304b8d61c5205a0a967139b00714e25a465692d2fb
#10 resolve docker.io/buildpacksio/pack:latest@sha256:8b3d6cd25a8d49f02153b1304b8d61c5205a0a967139b00714e25a465692d2fb 0.0s done
#10 DONE 0.1s

#9 [linux/arm64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 resolve ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296 0.0s done
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 0B / 32.49MB 0.2s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 0B / 27.35MB 0.2s
#9 ...

#10 [linux/arm64 pack 1/1] FROM docker.io/buildpacksio/pack:latest@sha256:8b3d6cd25a8d49f02153b1304b8d61c5205a0a967139b00714e25a465692d2fb
#10 sha256:e02b40a7fbc954742d3b4d32ff65d89b3a7d5b61d1cb3f8c7f27ad0041510ac1 93B / 93B 0.2s done
#10 sha256:ab6c3916fdc71988d2e46b9724bb0ccc9bbcc737125974b9151186f2c15c5f56 122.68kB / 122.68kB 0.1s done
#10 sha256:1bc7c5abb31a3f9b58b167264b993f3d9650a1ceb581c7f87956fc1a2ba32acc 8.38MB / 8.38MB 1.6s done
#10 extracting sha256:1bc7c5abb31a3f9b58b167264b993f3d9650a1ceb581c7f87956fc1a2ba32acc 0.2s done
#10 extracting sha256:ab6c3916fdc71988d2e46b9724bb0ccc9bbcc737125974b9151186f2c15c5f56 0.0s done
#10 extracting sha256:e02b40a7fbc954742d3b4d32ff65d89b3a7d5b61d1cb3f8c7f27ad0041510ac1 done
#10 DONE 2.1s

#9 [linux/arm64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 ...

#11 [linux/amd64 pack 1/1] FROM docker.io/buildpacksio/pack:latest@sha256:8b3d6cd25a8d49f02153b1304b8d61c5205a0a967139b00714e25a465692d2fb
#11 resolve docker.io/buildpacksio/pack:latest@sha256:8b3d6cd25a8d49f02153b1304b8d61c5205a0a967139b00714e25a465692d2fb 0.0s done
#11 sha256:ddfe8b92f3b0d65517d0461961fb1dc1a3b6cd282dd56e6679a055aac50e3086 93B / 93B 0.2s done
#11 sha256:0730885e89d1be898d896ef3d65d33de9e05e74389410cc651a7ed62cd0369da 122.68kB / 122.68kB 0.2s done
#11 sha256:13680c645e442a928e4681a535244f48190f0b133f7e17d92683a90577c0c958 9.21MB / 9.21MB 4.1s done
#11 extracting sha256:13680c645e442a928e4681a535244f48190f0b133f7e17d92683a90577c0c958 0.3s done
#11 extracting sha256:0730885e89d1be898d896ef3d65d33de9e05e74389410cc651a7ed62cd0369da 0.0s done
#11 extracting sha256:ddfe8b92f3b0d65517d0461961fb1dc1a3b6cd282dd56e6679a055aac50e3086 0.0s done
#11 DONE 4.6s

#9 [linux/arm64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 2.10MB / 32.49MB 5.1s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 4.19MB / 32.49MB 5.9s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 2.10MB / 27.35MB 5.0s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 6.29MB / 32.49MB 6.3s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 4.19MB / 27.35MB 5.6s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 8.39MB / 32.49MB 6.8s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 6.29MB / 27.35MB 6.2s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 10.49MB / 32.49MB 7.4s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 8.39MB / 27.35MB 6.6s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 10.49MB / 27.35MB 7.1s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 12.58MB / 32.49MB 8.1s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 12.58MB / 27.35MB 7.5s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 14.68MB / 27.35MB 8.0s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 14.68MB / 32.49MB 9.2s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 16.38MB / 27.35MB 8.4s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 17.83MB / 27.35MB 8.7s
#9 ...

#12 [linux/amd64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#12 resolve ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296 0.0s done
#12 sha256:87d4ecfab05c95d21c662274b2d77bfec215117c3e5580cdd123f644f7649a18 23.07MB / 34.02MB 9.8s
#12 sha256:dbf6a9befcdeecbb8813406afbd62ce81394e3869d84599f19f941aa5c74f3d1 17.83MB / 29.53MB 9.8s
#12 sha256:892b40bf4c25170e593c2c28bff84350836f0f942ba1fbe7ef3764d57911c55f 4.31kB / 4.31kB 0.9s done
#12 ...

#9 [linux/arm64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 19.92MB / 27.35MB 9.2s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 16.78MB / 32.49MB 10.5s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 22.02MB / 27.35MB 9.6s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 24.12MB / 27.35MB 10.1s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 26.21MB / 27.35MB 10.5s
#9 sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 27.35MB / 27.35MB 10.7s done
#9 extracting sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b
#9 sha256:6915365bb04c85203110f09bf55a62878b49a04b90afebe52f26cc6a29ba6fc9 0B / 4.32kB 0.2s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 19.60MB / 32.49MB 11.9s
#9 sha256:6915365bb04c85203110f09bf55a62878b49a04b90afebe52f26cc6a29ba6fc9 4.32kB / 4.32kB 0.2s done
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 23.07MB / 32.49MB 12.2s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 25.53MB / 32.49MB 12.5s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 27.26MB / 32.49MB 12.6s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 30.41MB / 32.49MB 12.9s
#9 sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 32.49MB / 32.49MB 13.1s done
#9 extracting sha256:79d0ea7dc1a848165a31e288cada1fa51dcd9bf302a305fe83a353c5c407110b 1.5s done
#9 extracting sha256:6915365bb04c85203110f09bf55a62878b49a04b90afebe52f26cc6a29ba6fc9 0.0s done
#9 extracting sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333
#9 extracting sha256:34201e6cfcb9ee1299a521d2344573646dafd1f3a639f21418ded41e4341f333 0.6s done
#9 DONE 13.9s

#12 [linux/amd64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#12 sha256:87d4ecfab05c95d21c662274b2d77bfec215117c3e5580cdd123f644f7649a18 34.02MB / 34.02MB 11.7s done
#12 sha256:dbf6a9befcdeecbb8813406afbd62ce81394e3869d84599f19f941aa5c74f3d1 29.53MB / 29.53MB 11.8s done
#12 extracting sha256:dbf6a9befcdeecbb8813406afbd62ce81394e3869d84599f19f941aa5c74f3d1 1.5s done
#12 extracting sha256:892b40bf4c25170e593c2c28bff84350836f0f942ba1fbe7ef3764d57911c55f 0.0s done
#12 extracting sha256:87d4ecfab05c95d21c662274b2d77bfec215117c3e5580cdd123f644f7649a18
#12 ...

#13 [linux/arm64 stage-1 2/4] COPY --from=pack /usr/local/bin/pack /usr/local/bin/pack
#13 DONE 0.7s

#12 [linux/amd64 stage-1 1/4] FROM ghcr.io/jericop/build-jammy:latest@sha256:d2321e90fe65a4790917e56c5bf590d8d403cfb02ae62ac6e7efb4cf1fe7e296
#12 extracting sha256:87d4ecfab05c95d21c662274b2d77bfec215117c3e5580cdd123f644f7649a18 1.1s done
#12 DONE 14.6s

#14 [linux/arm64 stage-1 3/4] COPY *.toml ./
#14 DONE 0.0s

#15 [linux/arm64 stage-1 4/4] RUN <<RUN_EOF (arch=amd64...)

#15 ...

#16 [linux/amd64 stage-1 2/4] COPY --from=pack /usr/local/bin/pack /usr/local/bin/pack
#16 DONE 0.2s

#17 [linux/amd64 stage-1 3/4] COPY *.toml ./
#17 DONE 0.0s

#15 [linux/arm64 stage-1 4/4] RUN <<RUN_EOF (arch=amd64...)
#15 0.217 + arch
#15 0.269 aarch64
#15 0.272 + uname -a
#15 0.309 Linux buildkitsandbox 6.3.13-linuxkit #1 SMP PREEMPT_DYNAMIC Thu Sep  7 07:54:49 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux
#15 0.313 + pack version
#15 1.288 0.31.0+git-3a994bd
#15 1.292 + pack builder create localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-arm64 --config example-builder.toml --publish
#15 2.307 Warning: builder configuration: empty 'order' definition
#15 4.844 Downloading from 'https://github.com/buildpacks/lifecycle/releases/download/v0.17.1/lifecycle-v0.17.1+linux.x86-64.tgz'
10.6 MB/10.6 MB0.6 MB
#15 ...

#18 [linux/amd64 stage-1 4/4] RUN <<RUN_EOF (arch=amd64...)
#18 0.120 + arch
#18 0.122 x86_64
#18 0.122 + uname -a
#18 0.125 Linux buildkitsandbox 6.3.13-linuxkit #1 SMP PREEMPT_DYNAMIC Thu Sep  7 07:54:49 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux
#18 0.126 + pack version
#18 0.194 0.31.0+git-3a994bd
#18 0.195 + pack builder create localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-amd64 --config example-builder.toml --publish
#18 0.247 Warning: builder configuration: empty 'order' definition
#18 2.694 Downloading from 'https://github.com/buildpacks/lifecycle/releases/download/v0.17.1/lifecycle-v0.17.1+linux.x86-64.tgz'
10.6 MB/10.6 MB0.6 MB
#18 20.90 Successfully created builder image 'localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-amd64'
#18 20.90 Tip: Run 'pack build <image-name> --builder localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-amd64' to use this builder
#18 DONE 21.0s

#15 [linux/arm64 stage-1 4/4] RUN <<RUN_EOF (arch=amd64...)
#15 26.69 Successfully created builder image 'localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-arm64'
#15 26.69 Tip: Run 'pack build <image-name> --builder localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-arm64' to use this builder
#15 DONE 26.7s
WARNING: No output specified with docker-container driver. Build result will only remain in the build cache. To push result image into registry use --push or to load image into docker use --load
+ rm create-arch-builders.Dockerfile
++ crane config localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-arm64
++ jq .architecture -r
+ '[' amd64 = amd64 ']'
+ echo 'ERROR The arm64 builder is using an amd64 architecture image'
ERROR The arm64 builder is using an amd64 architecture image
+ [[ ! -z '' ]]
+ echo 'Creating and pushing multi-arch builder in local registry: localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest'
Creating and pushing multi-arch builder in local registry: localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
+ docker buildx imagetools create -t localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-arm64 localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest-amd64
[+] Building 0.0s (1/1) FINISHED                                                                                                                                                 
 => [internal] pushing localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest                                                                                      0.0s
+ crane index filter localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest --platform linux -t localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
2023/11/01 13:11:30 existing manifest: sha256:3fe5dfccae6ee459aec803baea17d055dc4c369214fb7b31fa74d02999f65b5f
2023/11/01 13:11:30 localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest: digest: sha256:8414da11fa4d9db69dd7cd3e06f12bcecb6d26a7a6313a868c7b11b85af5b529 size: 290
localhost:5000/amd64-issue-multi-arch-builder-1698858643@sha256:8414da11fa4d9db69dd7cd3e06f12bcecb6d26a7a6313a868c7b11b85af5b529
+ crane manifest localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
+ jq
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.oci.image.index.v1+json",
  "manifests": [
    {
      "mediaType": "application/vnd.oci.image.manifest.v1+json",
      "size": 1685,
      "digest": "sha256:3fe5dfccae6ee459aec803baea17d055dc4c369214fb7b31fa74d02999f65b5f",
      "platform": {
        "architecture": "amd64",
        "os": "linux"
      }
    }
  ]
}
+ echo 'Testing the local multi-arch builder to ensure the lifecycle binary works.'
Testing the local multi-arch builder to ensure the lifecycle binary works.
+ for arch in amd64 arm64
+ docker pull --platform linux/amd64 --quiet localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
+ docker run --platform linux/amd64 --rm --entrypoint arch localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
x86_64
+ docker run --platform linux/amd64 --rm --entrypoint /cnb/lifecycle/lifecycle localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest -version
0.17.1+291a4660
+ for arch in amd64 arm64
+ docker pull --platform linux/arm64 --quiet localhost:5000/amd64-issue-multi-arch-builder-1698858643:latest
no matching manifest for linux/arm64 in the manifest list entries